(function(d){typeof define=="function"&&define.amd?define(d):d()})(function(){"use strict";class d{}class l{constructor(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}getRoot(){return this._root}destructor(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null}setParam(t,e,i){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),i))return this.show(null)}getParam(t,e){const i=this._data[t];if(typeof i<"u"||!e)return i;const s=this.getParentView();if(s)return s.getParam(t,e)}getUrl(){return this._segment.suburl()}getUrlString(){return this._segment.toString()}getParentView(){return this._parent}$$(t){if(typeof t=="string"){const e=this.getRoot();return e.queryView(i=>(i.config.id===t||i.config.localId===t)&&i.$scope===e.$scope,"self")}else return t}on(t,e,i){const s=t.attachEvent(e,i);return this._events.push({obj:t,id:s}),s}contains(t){for(const e in this._subs){const i=this._subs[e].view;if(i===t||i.contains(t))return!0}return!1}getSubView(t){const e=this.getSubViewInfo(t);if(e)return e.subview.view}getSubViewInfo(t){const e=this._subs[t||"default"];return e?{subview:e,parent:this}:t==="_top"?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null}_detachEvents(){const t=this._events;for(let e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)}_destroySubs(){for(const t in this._subs){const e=this._subs[t].view;e&&e.destructor()}this._subs={}}_init_url_data(){const t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)}_getDefaultSub(){if(this._subs.default)return this._subs.default;for(const t in this._subs){const e=this._subs[t];if(!e.branch&&e.view&&t!=="_top"){const i=e.view._getDefaultSub();if(i)return i}}}_routed_view(){const t=this.getParentView();if(!t)return!0;const e=t._getDefaultSub();return!e&&e!==this?!1:t._routed_view()}}function g(n){n[0]==="/"&&(n=n.substr(1));const t=n.split("/"),e=[];for(let i=0;i<t.length;i++){const s=t[i],o={};let r=s.indexOf(":");if(r===-1&&(r=s.indexOf("?")),r!==-1){const h=s.substr(r+1).split(/[\:\?\&]/g);for(const u of h){const a=u.split("=");o[a[0]]=decodeURIComponent(a[1])}}e[i]={page:r>-1?s.substr(0,r):s,params:o,isNew:!0}}return e}function f(n){const t=[];for(const e of n){t.push("/"+e.page);const i=$(e.params);i&&t.push("?"+i)}return t.join("")}function $(n){const t=[];for(const e in n)typeof n[e]!="object"&&(t.length&&t.push("&"),t.push(e+"="+encodeURIComponent(n[e])));return t.join("")}class p{constructor(t,e){this._next=1,typeof t=="string"?this.route={url:g(t),path:t}:this.route=t,this.index=e}current(){return this.route.url[this.index]}next(){return this.route.url[this.index+this._next]}suburl(){return this.route.url.slice(this.index)}shift(t){const e=new p(this.route,this.index+this._next);return e.setParams(e.route.url,t,e.index),e}setParams(t,e,i){if(e){const o=t[i].params;for(var s in e)o[s]=e[s]}}refresh(){const t=this.route.url;for(let e=this.index+1;e<t.length;e++)t[e].isNew=!0}toString(){const t=f(this.suburl());return t?t.substr(1):""}_join(t,e){let i=this.route.url;if(t===null)return i;const s=this.route.url;let o=!0;if(i=s.slice(0,this.index+(e?this._next:0)),t){i=i.concat(g(t));for(let r=0;r<i.length;r++)s[r]&&(i[r].view=s[r].view),o&&s[r]&&i[r].page===s[r].page?i[r].isNew=!1:i[r].isNew&&(o=!1)}return i}append(t){const e=this._join(t,!0);return this.route.path=f(e),this.route.url=e,this.route.path}show(t,e,i){const s=this._join(t.url,i);return this.setParams(s,t.params,this.index+(i?this._next:0)),new Promise((o,r)=>{const h=f(s),u={url:s,redirect:h,confirm:Promise.resolve()},a=e?e.app:null;if(a&&!a.callEvent("app:guard",[u.redirect,e,u])){r(new d);return}u.confirm.catch(c=>r(c)).then(()=>{if(u.redirect===null){r(new d);return}if(u.redirect!==h){a.show(u.redirect),r(new d);return}this.route.path=h,this.route.url=s,o()})})}size(t){this._next=t}split(){const t={url:this.route.url.slice(this.index+1),path:""};return t.url.length&&(t.path=f(t.url)),new p(t,0)}update(t,e,i){const s=this.route.url[this.index+(i||0)];if(!s)return this.route.url.push({page:"",params:{}}),this.update(t,e,i);t===""?s.page=e:s.params[t]=e,this.route.path=f(this.route.url)}}class _ extends l{constructor(t,e){super(t.webix),this.app=t,this._children=[]}ui(t,e){e=e||{};const i=e.container||t.container,s=this.app.createView(t);return this._children.push(s),s.render(i,this._segment,this),typeof t!="object"||t instanceof l?s:s.getRoot()}show(t,e){if(e=e||{},typeof t=="object"){for(const i in t)this.setParam(i,t[i]);t=null}else{if(t.substr(0,1)==="/")return this.app.show(t,e);if(t.indexOf("./")===0&&(t=t.substr(2)),t.indexOf("../")===0){const s=this.getParentView();return s?s.show(t.substr(3),e):this.app.show("/"+t.substr(3))}const i=this.getSubViewInfo(e.target);if(i){if(i.parent!==this)return i.parent.show(t,e);if(e.target&&e.target!=="default")return this._renderFrameLock(e.target,i.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)}_show(t,e,i){return t.show(e,i,!0).then(()=>(this._init_url_data(),this._urlChange())).then(()=>{t.route.linkRouter&&(this.app.getRouter().set(t.route.path,{silent:!0}),this.app.callEvent("app:route",[t.route.path]))})}init(t,e){}ready(t,e){}config(){this.app.webix.message("View:Config is not implemented")}urlChange(t,e){}destroy(){}destructor(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),super.destructor())}use(t,e){t(this.app,this,e)}refresh(){return this.getUrl(),this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)}render(t,e,i){typeof e=="string"&&(e=new p(e,0)),this._segment=e,this._parent=i,this._init_url_data(),t=t||document.body;const s=typeof t=="string"?this.webix.toNode(t):t;return this._container!==s?(this._container=s,this._render(e)):this._urlChange().then(()=>this.getRoot())}_render(t){const e=this.config();return e.then?e.then(i=>this._render_final(i,t)):this._render_final(e,t)}_render_final(t,e){let i=null,s=null,o=!1;if(this._container.tagName?s=this._container:(i=this._container,i.popup?(s=document.body,o=!0):s=this.webix.$$(i.id)),!this.app||!s)return Promise.reject(null);let r;const h=this._segment.current(),u={ui:{}};this.app.copyConfig(t,u.ui,this._subs),this.app.callEvent("app:render",[this,e,u]),u.ui.$scope=this,!i&&h.isNew&&h.view&&h.view.destructor();try{if(i&&!o){const c=s,V=c.getParentView();V&&V.name==="multiview"&&!u.ui.id&&(u.ui.id=c.config.id)}this._root=this.app.webix.ui(u.ui,s);const a=this._root;o&&a.setPosition&&!a.isVisible()&&a.show(),i&&(i.view&&i.view!==this&&i.view!==this.app&&i.view.destructor(),i.id=this._root.config.id,this.getParentView()||!this.app.app?i.view=this:i.view=this.app),h.isNew&&(h.view=this,h.isNew=!1),r=Promise.resolve(this._init(this._root,e)).then(()=>this._urlChange().then(()=>(this._initUrl=null,this.ready(this._root,e.suburl()))))}catch(a){r=Promise.reject(a)}return r.catch(a=>this._initError(this,a))}_init(t,e){return this.init(t,e.suburl())}_urlChange(){this.app.callEvent("app:urlchange",[this,this._segment]);const t=[];for(const e in this._subs){const i=this._subs[e],s=this._renderFrameLock(e,i,null);s&&t.push(s)}return Promise.all(t).then(()=>this.urlChange(this._root,this._segment.suburl()))}_renderFrameLock(t,e,i){if(!e.lock){const s=this._renderFrame(t,e,i);s&&(e.lock=s.then(()=>e.lock=null,()=>e.lock=null))}return e.lock}_renderFrame(t,e,i){if(t==="default")if(this._segment.next()){let o=i?i.params:null;return e.params&&(o=this.webix.extend(o||{},e.params)),this._createSubView(e,this._segment.shift(o))}else e.view&&e.popup&&(e.view.destructor(),e.view=null);if(i!==null&&(e.url=i.url,e.params&&(i.params=this.webix.extend(i.params||{},e.params))),e.route){if(i!==null)return e.route.show(i,e.view).then(()=>this._createSubView(e,e.route));if(e.branch)return}let s=e.view;if(!s&&e.url){if(typeof e.url=="string")return e.route=new p(e.url,0),i&&e.route.setParams(e.route.route.url,i.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);if(typeof e.url=="function"&&!(s instanceof e.url)){const o=this.app._override(e.url);o.prototype instanceof w?s=new o({app:this.app}):s=new o(this.app,"")}s||(s=e.url)}if(s)return s.render(e,e.route||this._segment,this)}_initError(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0}_createSubView(t,e){return this.app.createFromURL(e.current()).then(i=>i.render(t,e,this))}_destroyKids(){const t=this._children;for(let e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]}}class S extends _{constructor(t,e){super(t,e),this._ui=e.ui}config(){return this._ui}}class P{constructor(t,e,i){this.path="",this.app=i}set(t,e){this.path=t;const i=this.app;i.app.getRouter().set(i._segment.append(this.path),{silent:!0})}get(){return this.path}}let m=!0;class w extends l{constructor(t){const e=(t||{}).webix||window.webix;t=e.extend({name:"App",version:"1.0",start:"/home"},t,!0),super(e,t),this.config=t,this.app=this.config.app,this.ready=Promise.resolve(),this._services={},this.webix.extend(this,this.webix.EventSystem)}getUrl(){return this._subSegment.suburl()}getUrlString(){return this._subSegment.toString()}getService(t){let e=this._services[t];return typeof e=="function"&&(e=this._services[t]=e(this)),e}setService(t,e){this._services[t]=e}destructor(){this.getSubView().destructor(),super.destructor()}copyConfig(t,e,i){if((t instanceof l||typeof t=="function"&&t.prototype instanceof l)&&(t={$subview:t}),typeof t.$subview<"u")return this.addSubView(t,e,i);const s=t instanceof Array;e=e||(s?[]:{});for(const o in t){let r=t[o];if(typeof r=="function"&&r.prototype instanceof l&&(r={$subview:r}),r&&typeof r=="object"&&!(r instanceof this.webix.DataCollection)&&!(r instanceof RegExp)&&!(r instanceof Map))if(r instanceof Date)e[o]=new Date(r);else{const h=this.copyConfig(r,r instanceof Array?[]:{},i);h!==null&&(s?e.push(h):e[o]=h)}else e[o]=r}return e}getRouter(){return this.$router}clickHandler(t,e){if(t&&(e=e||t.target||t.srcElement,e&&e.getAttribute)){const s=e.getAttribute("trigger");if(s)return this._forView(e,r=>r.app.trigger(s)),t.cancelBubble=!0,t.preventDefault();const o=e.getAttribute("route");if(o)return this._forView(e,r=>r.show(o)),t.cancelBubble=!0,t.preventDefault()}const i=e.parentNode;i&&this.clickHandler(t,i)}getRoot(){return this.getSubView().getRoot()}refresh(){return this._subSegment?this.getSubView().refresh().then(t=>(this.callEvent("app:route",[this.getUrl()]),t)):Promise.resolve(null)}loadView(t){const e=this.config.views;let i=null;if(t==="")return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{e&&(typeof e=="function"?i=e(t):i=e[t],typeof i=="string"&&(t=i,i=null)),i||(t==="_hidden"?i={hidden:!0}:t==="_blank"?i={}:(t=t.replace(/\./g,"/"),i=this.require("jet-views",t)))}catch(s){i=this._loadError(t,s)}return i.then||(i=Promise.resolve(i)),i=i.then(s=>s.__esModule?s.default:s).catch(s=>this._loadError(t,s)),i}_forView(t,e){const i=this.webix.$$(t);i&&e(i.$scope)}_loadViewDynamic(t){return null}createFromURL(t){let e;return t.isNew||!t.view?e=this.loadView(t.page).then(i=>this.createView(i,"",t.params)):e=Promise.resolve(t.view),e}_override(t){const e=this.config.override;if(e){let i;for(;t;)i=t,t=e.get(t);return i}return t}createView(t,e,i){t=this._override(t);let s;if(typeof t=="function"){if(t.prototype instanceof w)return new t({app:this,name:e,params:i,router:P});if(t.prototype instanceof l)return new t(this,{name:e,params:i});t=t(this)}return t instanceof l?s=t:s=new S(this,{name:e,ui:t}),s}show(t,e){return t&&this.app&&t.indexOf("//")==0?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)}trigger(t,...e){this.apply(t,e)}apply(t,e){this.callEvent(t,e)}action(t){return this.webix.bind(function(...e){this.apply(t,e)},this)}on(t,e){this.attachEvent(t,e)}use(t,e){t(this,null,e)}error(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug){for(var i=0;i<e.length;i++)if(console.error(e[i]),e[i]instanceof Error){let s=e[i].message;s.indexOf("Module build failed")===0?(s=s.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML=`<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${s}</pre>`):(s+="<br><br>Check console for more details",this.webix.message({type:"error",text:s,expire:-1}))}debugger}}render(t,e,i){this._container=typeof t=="string"?this.webix.toNode(t):t||document.body;const s=!this.$router;let o=null;s?(m&&"tagName"in this._container&&(this.webix.event(document.body,"click",c=>this.clickHandler(c)),m=!1),typeof e=="string"&&(e=new p(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):typeof e=="string"?o=e:this.app?o=e.split().route.path||this.config.start:o=e.toString();const r=i?i.params:this.config.params||null,h=this.getSubView(),u=this._subSegment,a=u.show({url:o,params:r},h).then(()=>this.createFromURL(u.current())).then(c=>c.render(t,u)).then(c=>(this.$router.set(u.route.path,{silent:!0}),this.callEvent("app:route",[this.getUrl()]),c));return this.ready=this.ready.then(()=>a),a}getSubView(){if(this._subSegment){const t=this._subSegment.current().view;if(t)return t}return new _(this,{})}require(t,e){return null}_first_start(t){this._segment=t;const e=i=>setTimeout(()=>{this.show(i).catch(s=>{if(!(s instanceof d))throw s})},1);if(this.$router=new this.config.router(e,this.config,this),this._container===document.body&&this.config.animation!==!1){const i=this._container;this.webix.html.addCss(i,"webixappstart"),setTimeout(()=>{this.webix.html.removeCss(i,"webixappstart"),this.webix.html.addCss(i,"webixapp")},10)}if(t){if(this.app){const i=t,s=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new p(this.config.start,0),i.current().view=s||this}}else{let i=this.$router.get();i||(i=this.config.start,this.$router.set(i,{silent:!0})),t=new p(i,0)}return t}_loadError(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}}addSubView(t,e,i){const s=t.$subview!==!0?t.$subview:null,o=t.name||(s?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(i[o]={id:e.id,url:s,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e}}class I{constructor(t,e){this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=()=>this.cb(this.get())}set(t,e){if(this.config.routes){const i=t.split("?",2);for(const s in this.config.routes)if(this.config.routes[s]===i[0]){t=s+(i.length>1?"?"+i[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),(!e||!e.silent)&&setTimeout(()=>this.cb(t),1)}get(){let t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t=t!=="/"&&t!=="#"?t:"",this.config.routes){const e=t.split("?",2),i=this.config.routes[e[0]];i&&(t=i+(e.length>1?"?"+e[1]:""))}return t}_detectPrefix(){const t=this.config.routerPrefix;this.sufix="#"+(typeof t>"u"?"!":t),this.prefix=document.location.href.split("#",2)[0]}_getRaw(){return document.location.href}}let x=!1;function v(n){if(x||!n)return;x=!0;const t=window;t.Promise||(t.Promise=n.promise);const e=n.version.split(".");e[0]*10+e[1]*1<53&&(n.ui.freeze=function(r){const h=r();return h&&h.then?h.then(function(u){return n.ui.$freeze=!1,n.ui.resize(),u}):(n.ui.$freeze=!1,n.ui.resize()),h});const i=n.ui.baselayout.prototype.addView,s=n.ui.baselayout.prototype.removeView,o={addView(r,h){if(this.$scope&&this.$scope.webixJet&&!r.queryView){const u=this.$scope,a={};r=u.app.copyConfig(r,{},a),i.apply(this,[r,h]);for(const c in a)u._renderFrame(c,a[c],null).then(()=>{u._subs[c]=a[c]});return r.id}else return i.apply(this,arguments)},removeView(){if(s.apply(this,arguments),this.$scope&&this.$scope.webixJet){const r=this.$scope._subs;for(const h in r){const u=r[h];n.$$(u.id)||(u.view.destructor(),delete r[h])}}}};n.extend(n.ui.layout.prototype,o,!0),n.extend(n.ui.baselayout.prototype,o,!0),n.protoUI({name:"jetapp",$init(r){this.$app=new this.app(r);const h=n.uid().toString();r.body={id:h},this.$ready.push(function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:h})})}},n.ui.proxy,n.EventSystem)}class E extends w{constructor(t){t.router=t.router||I,super(t),v(this.webix)}require(t,e){return require(t+"/"+e)}}class N{constructor(t,e){this.path="",this.cb=t}set(t,e){this.path=t,(!e||!e.silent)&&setTimeout(()=>this.cb(t),1)}get(){return this.path}}let y=window.webix;y&&v(y);const b=window;b.Promise||(b.Promise=b.webix.promise);const k="";class R extends _{constructor(t){super(t,null),this.name="switchinput1",t.config.view==this.name&&this._setConfig(t.config)}_setConfig(t){this._config=t}ready(t){const e=t.queryView({localId:"switch1"});if(e.config.view==="combo"){const s=(e.getList().serialize()||[]).map(o=>o.id);if(s.length===0){t.queryView({localId:"switch_btn"}).setValue(1);return}e.getValue()?s.includes(e.getValue())?t.queryView({localId:"switch_btn"}).setValue(0):t.queryView({localId:"switch_btn"}).setValue(1):t.queryView({localId:"switch_btn"}).setValue(0)}else{const o=(t.queryView({localId:"switch2"}).getList().serialize()||[]).map(r=>r.id);if(o.length===0){t.queryView({localId:"switch_btn"}).setValue(0);return}e.getValue()?o.includes(e.getValue())?t.queryView({localId:"switch_btn"}).setValue(1):t.queryView({localId:"switch_btn"}).setValue(0):t.queryView({localId:"switch_btn"}).setValue(1)}}config(){const t=this._config.showInput.view==="combo"?"选择":"输入",e=this._config.showInput.view==="combo"?"输入":"选择";return{cols:[this._createShowInput(this._config.showInput),this._createHiddenInput(this._config.hiddenInput),{view:"switch",localId:"switch_btn",width:76,css:{"margin-left":"10px"},onLabel:t,offLabel:e,on:{onChange:function(i){i==1?(this.$scope.$$("switch1").hide(),this.$scope.$$("switch2").show()):(this.$scope.$$("switch1").show(),this.$scope.$$("switch2").hide())}}}]}}_createShowInput(t){return t&&(t.id=void 0,t.localId="switch1",t.name="switch1",t.labelPosition=this._config.labelPosition,t.labelAlign=this._config.labelAlign,t.labelWidth=this._config.labelWidth),t}_createHiddenInput(t){return t&&(t.localId="switch2",t.hidden=!0,t.name="switch2",t.labelPosition=this._config.labelPosition,t.labelAlign=this._config.labelAlign,t.labelWidth=this._config.labelWidth),t}}class C extends E{constructor(t){const e={start:"SwitchInput",router:N,views:{SwitchInput:R}};super({...e,...t})}}webix.protoUI({name:"switchinput1",app:C,$init:function(){let n=this.$view.className;this.$view.className=n+"  webix-form-border-hide"},getValue:function(){try{let n=this.$app.$$("switch1"),t=this.$app.$$("switch2");return n.isVisible()?n.getValue():t.getValue()}catch{return""}},setValue(n){let t=this.$app.$$("switch1"),e=this.$app.$$("switch2");t.setValue(n),e.setValue(n)},validate:function(){let n=this.$app.$$("switch1"),t=this.$app.$$("switch2");return n.isVisible()&&n.config.required?(n.validate()==!0?n.$view.className="webix_control webix_el_text":n.$view.className="webix_el_text webix_control  webix_invalid",n.validate()):t.isVisible()&&t.config.required?(t.validate()==!0?t.$view.className="webix_control webix_el_text":t.$view.className="webix_el_text webix_control  webix_invalid",t.validate()):!0},disable(){this.$app.$$("switch1").disable(),this.$app.$$("switch2").disable()}},webix.ui.jetapp,webix.Values)});
